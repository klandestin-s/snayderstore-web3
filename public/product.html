<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SNAYDER'S STORE - Toko Digital Terpercaya</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="icon" href="https://raw.githubusercontent.com/klandestin-s/Cloud_v2/main/tmp/b281edce.png" />
        <link rel="stylesheet" href="css/product.css">
    <script src="https://www.google.com/recaptcha/api.js?render=6LfZknsrAAAAAOfe66QaWr0TzRixA1oGm-IMo8sc"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="#" class="logo-brand">
                <i class="fas fa-store"></i>
                <span class="brand-text">SNAYDERS</span>
            </a>

            <div class="nav-main-container">
                <div class="search-container desktop-only">
                    <input type="text" placeholder="Cari produk..." id="searchInput" />
                    <button class="search-btn"><i class="fas fa-search"></i></button>
                </div>

                <div class="nav-right">
                    <a href="index.html" class="nav-link"> <i class="fas fa-home"></i></a>
                    <div class="service-dropdown">
                        <button class="service-btn"><i class="fas fa-concierge-bell"></i> SERVICE <i class="fas fa-caret-down"></i></button>
                        <div class="dropdown-content">
                            <a href="downloads.html"><i class="fas fa-download"></i> Download Config</a>
                            <a href="product.html"><i class="fas fa-box-open"></i> Produk Kami</a>
                            <a href="testimoni.html"><i class="fas fa-chart-line"></i> Testimoni pembeli</a>
                            <a href="index.html#community" class="nav-link"> <i class="fas fa-users"></i> Komunitas </a>
                            <button class="btn-admin-nav admin-login-btn"><i class="fas fa-lock"></i> Admin Login</button>
                            <button class="nav-link theme-toggle-btn desktop-only"><i class="fas fa-moon"></i> Tema</button>
                        </div>
                    </div>

                    <div class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="nav-links" id="navLinks">
        <a href="index.html" class="nav-link active"> <i class="fas fa-home"></i> Beranda </a>
        <a href="downloads.html" class="nav-link"> <i class="fas fa-download"></i> Download Config </a>
        <a href="product.html" class="nav-link"> <i class="fas fa-box-open"></i> Produk Kami </a>
        <a href="testimoni.html" class="nav-link"><i class="fas fa-chart-line"></i> Testimoni pembeli</a>
        <a href="index.html#community" class="nav-link"> <i class="fas fa-users"></i> Komunitas </a>
        <button class="nav-link btn-admin-nav admin-login-btn"><i class="fas fa-lock"></i> Admin Login</button>
        <button class="nav-link theme-toggle-btn mobile-only"><i class="fas fa-moon"></i> Tema</button>
    </div>
    <!-- Tambahkan Search Mobile di sini -->
    <div class="mobile-search-wrapper mobile-only">
        <div class="search-container">
            <input type="text" placeholder="Cari produk..." id="searchInputMobile" />
            <button class="search-btn"><i class="fas fa-search"></i></button>
        </div>
    </div>

    <!-- TAMBAHAN: NAVIGASI PRODUK -->
    <div class="product-nav-container">
        <div class="product-nav-buttons">
            <button class="product-nav-btn active" data-target="all"><i class="fas fa-boxes"></i> Semua Produk</button>
            <button class="product-nav-btn" data-target="trending"><i class="fas fa-fire"></i> Produk Trending</button>
            <button class="product-nav-btn" data-target="config premium"><i class="fas fa-crown"></i> Config Premium</button>
            <button class="product-nav-btn" data-target="vps hosting"><i class="fas fa-server"></i> VPS Hosting</button>
            <button class="product-nav-btn" data-target="panel"><i class="fas fa-tachometer-alt"></i> Panel</button>
            <button class="product-nav-btn" data-target="script"><i class="fas fa-code"></i> Script</button>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">Memuat data...</p>
    </div>

    <div id="content-wrapper">
        <section class="products-section" id="produk">
            <h2 class="section-title">Produk Kami</h2>
            <div class="products-grid" id="productsGrid">
                <!-- Produk akan dimuat melalui JavaScript -->
            </div>
        </section>

        <section class="products-section" id="trending">
            <h2 class="section-title">Produk Trending</h2>
            <div class="products-grid" id="trendingGrid"></div>
        </section>
    </div>

    <div class="modal-overlay" id="detailModal">
        <div class="modal-content">
            <button class="modal-close" id="closeDetailModal">&times;</button>
            <h3 class="modal-title" id="detailProductTitle"></h3>

            <div class="modal-description-container">
                <p class="modal-subtitle" id="detailProductDescription"></p>
            </div>

            <div class="modal-packages-container">
                <div class="package-list" id="packageList"></div>
            </div>

            <button class="btn-submit" id="orderFromDetailBtn"><i class="fas fa-shopping-cart"></i> ORDER SEKARANG</button>
        </div>
    </div>

    <div class="modal-overlay" id="orderModal">
        <div class="modal-content">
            <button class="modal-close" id="closeOrderModal">&times;</button>
            <h3 class="modal-title">Form Order</h3>

            <form id="orderForm">
                <div class="form-group">
                    <label for="customerName">Nama Lengkap</label>
                    <input type="text" id="customerName" required placeholder="Masukkan nama Anda" />
                </div>

                <div class="form-group">
                    <label for="productName">Produk</label>
                    <input type="text" id="productName" readonly />
                </div>

                <div class="form-group">
                    <label for="packageSelect">Pilih Paket</label>
                    <select id="packageSelect" required>
                        <option value="">-- Pilih Paket --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="productPrice">Harga</label>
                    <input type="text" id="productPrice" readonly />
                </div>

                <div class="form-group">
                    <label for="productDescription">Deskripsi Produk</label>
                    <textarea id="productDescription" rows="3" readonly></textarea>
                </div>

                <button type="submit" class="btn-submit" id="submitOrderBtn"><i class="fab fa-whatsapp"></i> Order via WhatsApp</button>
            </form>
        </div>
    </div>

    <div class="admin-modal" id="adminLoginModal">
        <div class="admin-modal-content">
            <button class="modal-close" id="closeAdminModal">&times;</button>
            <h3 class="admin-modal-title">Admin Login</h3>

            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" required />
                </div>

                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required />
                </div>

                <button type="submit" class="btn-submit"><i class="fas fa-sign-in-alt"></i> Login</button>
            </form>
        </div>
    </div>

    <div class="image-zoom-modal" id="imageZoomModal">
        <div class="zoomed-image-container">
            <button class="zoom-close-btn" id="closeImageZoomModal">&times;</button>
            <img src="" alt="Zoomed Image" class="zoomed-image" id="zoomedImage" />
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <footer>
        <div class="social-links">
            <a href="https://www.facebook.com/snayderstore.2025" title="Facebook" target="_blank">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a href="https://wa.me/6287866361260" title="WhatsApp" target="_blank">
                <i class="fab fa-whatsapp"></i>
            </a>
            <a href="https://t.me/snayderstore" title="Telegram" target="_blank">
                <i class="fab fa-telegram"></i>
            </a>
            <a href="mailto:snaydersonly@gmail.com" title="Email" target="_blank">
                <i class="fas fa-envelope"></i>
            </a>
        </div>
        <p>&copy; 2025 <strong>SNAYDER'S STORE</strong> &mdash; Allright Reserved <i class="fas fa-heart" style="color: var(--accent)"></i></p>
    </footer>

    <script>
        const detailModal = document.getElementById("detailModal");
        const closeDetailModal = document.getElementById("closeDetailModal");
        const orderModal = document.getElementById("orderModal");
        const closeOrderModal = document.getElementById("closeOrderModal");
        const orderForm = document.getElementById("orderForm");
        const productNameInput = document.getElementById("productName");
        const productPriceInput = document.getElementById("productPrice");
        const packageSelect = document.getElementById("packageSelect");
        const productDescriptionInput = document.getElementById("productDescription");
        const packageList = document.getElementById("packageList");
        const detailProductTitle = document.getElementById("detailProductTitle");
        const detailProductDescription = document.getElementById("detailProductDescription");
        const orderFromDetailBtn = document.getElementById("orderFromDetailBtn");
        const adminLoginModal = document.getElementById("adminLoginModal");
        const closeAdminModal = document.getElementById("closeAdminModal");
        const adminLoginForm = document.getElementById("adminLoginForm");
        const adminUsernameInput = document.getElementById("adminUsername");
        const adminPasswordInput = document.getElementById("adminPassword");
        const productsGrid = document.getElementById("productsGrid");
        const trendingGrid = document.getElementById("trendingGrid");
        const notification = document.getElementById("notification");
        const submitOrderBtn = document.getElementById("submitOrderBtn");
        const loadingOverlay = document.getElementById("loadingOverlay");
        const menuToggle = document.getElementById("menuToggle");
        const navLinks = document.getElementById("navLinks");
        const searchInput = document.getElementById("searchInput");
        const imageZoomModal = document.getElementById("imageZoomModal");
        const closeImageZoomModal = document.getElementById("closeImageZoomModal");
        const zoomedImage = document.getElementById("zoomedImage");

        let products = [];
        let selectedProduct = null;
        let selectedPackage = null;

        function formatPrice(price) {
            return new Intl.NumberFormat("id-ID", {
                style: "currency",
                currency: "IDR",
                maximumFractionDigits: 0,
            }).format(price);
        }

        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            setTimeout(() => {
                notification.className = "notification";
            }, 3000);
        }

        async function fetchProducts() {
            try {
                const response = await fetch("/api/products");
                if (!response.ok) throw new Error("Gagal memuat produk");
                return await response.json();
            } catch (error) {
                console.error("Error fetching products:", error);
                showNotification("Gagal memuat data produk", "error");
                return [];
            }
        }

        function renderProducts(products) {
            productsGrid.innerHTML = "";

            const filteredProducts = products.filter((p) => !p.rating || p.rating <= 4.5);

            filteredProducts.forEach((product, index) => {
                const card = document.createElement("div");
                card.className = `product-card fade-in ${index > 0 ? "delay-" + index : ""}`;
                const badge = product.badge ? `<span class="product-badge">${product.badge}</span>` : "";

                card.innerHTML = `
                    ${badge}
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-content">
                        <div class="product-top">
                            <h3 class="product-title">${product.name}</h3>
                        </div>
                        <div class="product-spacer"></div>
                        <div class="product-description-container">
                            <p class="product-description">${product.description}</p>
                        </div>
                        <div class="product-footer">
                            <p class="product-price">Mulai ${formatPrice(product.price)}</p>
                            <div class="product-actions">
                                <button class="action-btn btn-order" data-product="${product.id}">
                                    <i class="fas fa-shopping-cart"></i> Order
                                </button>
                                <button class="action-btn btn-details" data-product="${product.id}">
                                    <i class="fas fa-info-circle"></i> Detail
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                productsGrid.appendChild(card);

                card.querySelector(".product-image").addEventListener("click", function () {
                    openImageZoomModal(product.image);
                });
            });

            document.querySelectorAll(".btn-details").forEach((button) => {
                button.addEventListener("click", function () {
                    const productId = this.getAttribute("data-product");
                    openDetailModal(productId);
                });
            });

            document.querySelectorAll(".btn-order").forEach((button) => {
                button.addEventListener("click", function () {
                    const productId = this.getAttribute("data-product");
                    openOrderModal(productId);
                });
            });
        }

        function renderTrendingProducts(products) {
            trendingGrid.innerHTML = "";

            const trendingProducts = products.filter((p) => p.rating > 4.5);

            if (trendingProducts.length === 0) {
                trendingGrid.innerHTML = `
                    <div class="no-trending">
                        <i class="fas fa-star"></i>
                        <h3>Tidak ada produk trending saat ini</h3>
                        <p>Cek kembali nanti ya!</p>
                    </div>
                `;
                return;
            }

            trendingProducts.forEach((product, index) => {
                const card = document.createElement("div");
                card.className = `product-card fade-in ${index > 0 ? "delay-" + index : ""}`;

                card.innerHTML = `
                    <span class="product-badge trending-badge">TRENDING</span>
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-content">
                        <div class="product-top">
                            <h3 class="product-title">${product.name}</h3>
                        </div>
                        <div class="product-spacer"></div>
                        <div class="product-description-container">
                            <p class="product-description">${product.description}</p>
                        </div>
                        <div class="product-stats">
                            <div class="product-stat">
                                <i class="fas fa-star"></i> ${product.rating.toFixed(1)}
                            </div>
                            <div class="product-stat">
                                <i class="fas fa-shopping-cart"></i> ${product.sold}
                            </div>
                            <div class="product-stat">
                                <i class="fas fa-eye"></i> ${product.views}
                            </div>
                        </div>
                        <div class="product-footer">
                            <p class="product-price">Mulai ${formatPrice(product.price)}</p>
                            <div class="product-actions">
                                <button class="action-btn btn-order" data-product="${product.id}">
                                    <i class="fas fa-shopping-cart"></i> Order
                                </button>
                                <button class="action-btn btn-details" data-product="${product.id}">
                                    <i class="fas fa-info-circle"></i> Detail
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                trendingGrid.appendChild(card);

                card.querySelector(".product-image").addEventListener("click", function () {
                    openImageZoomModal(product.image);
                });
            });

            trendingGrid.querySelectorAll(".btn-details").forEach((button) => {
                button.addEventListener("click", function () {
                    const productId = this.getAttribute("data-product");
                    openDetailModal(productId);
                });
            });

            trendingGrid.querySelectorAll(".btn-order").forEach((button) => {
                button.addEventListener("click", function () {
                    const productId = this.getAttribute("data-product");
                    openOrderModal(productId);
                });
            });
        }

        function openImageZoomModal(imageUrl) {
            zoomedImage.src = imageUrl;
            imageZoomModal.classList.add("active");
            document.body.style.overflow = "hidden";
        }

        function openDetailModal(productId) {
            selectedProduct = products.find((p) => p.id == productId);

            if (selectedProduct) {
                detailProductTitle.textContent = selectedProduct.name;
                detailProductDescription.textContent = selectedProduct.description;

                packageList.innerHTML = "";
                if (selectedProduct.packages && selectedProduct.packages.length > 0) {
                    selectedProduct.packages.forEach((pkg) => {
                        const packageItem = document.createElement("div");
                        packageItem.className = "package-item";
                        packageItem.innerHTML = `
                            <div class="package-name">${pkg.name}</div>
                            <div class="package-price">${formatPrice(pkg.price)}</div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.5rem;">${pkg.description || ""}</div>
                        `;
                        packageList.appendChild(packageItem);
                    });
                } else {
                    packageList.innerHTML = "<p>Tidak ada paket tersedia</p>";
                }

                detailModal.classList.add("active");
            }
        }

        function openOrderModal(productId) {
            selectedProduct = products.find((p) => p.id == productId);

            if (selectedProduct) {
                productNameInput.value = selectedProduct.name;
                productDescriptionInput.value = selectedProduct.description;

                packageSelect.innerHTML = '<option value="">-- Pilih Paket --</option>';

                if (selectedProduct.packages && selectedProduct.packages.length > 0) {
                    selectedProduct.packages.forEach((pkg) => {
                        const option = document.createElement("option");
                        option.value = pkg.id;
                        option.textContent = `${pkg.name} - ${formatPrice(pkg.price)}`;
                        option.setAttribute("data-price", pkg.price);
                        option.setAttribute("data-name", pkg.name);
                        packageSelect.appendChild(option);
                    });

                    packageSelect.value = selectedProduct.packages[0].id;
                    productPriceInput.value = formatPrice(selectedProduct.packages[0].price);
                    selectedPackage = selectedProduct.packages[0];
                } else {
                    const option = document.createElement("option");
                    option.value = "default";
                    option.textContent = "Paket Standar";
                    packageSelect.appendChild(option);
                    packageSelect.disabled = true;
                    productPriceInput.value = formatPrice(selectedProduct.price);
                    selectedPackage = {
                        id: "default",
                        name: "Paket Standar",
                        price: selectedProduct.price,
                    };
                }

                orderModal.classList.add("active");
            }
        }

        packageSelect.addEventListener("change", function () {
            const selectedOption = packageSelect.options[packageSelect.selectedIndex];
            const price = selectedOption.getAttribute("data-price");
            const name = selectedOption.getAttribute("data-name");

            if (price && name) {
                productPriceInput.value = formatPrice(parseInt(price));
                selectedPackage = {
                    id: selectedOption.value,
                    name,
                    price: parseInt(price),
                };
            }
        });

        function closeModal() {
            detailModal.classList.remove("active");
            orderModal.classList.remove("active");
            adminLoginModal.classList.remove("active");
            imageZoomModal.classList.remove("active");
            document.body.style.overflow = "auto";
            selectedProduct = null;
            selectedPackage = null;
        }

        orderFromDetailBtn.addEventListener("click", function () {
            if (selectedProduct) {
                closeModal();
                setTimeout(() => {
                    openOrderModal(selectedProduct.id);
                }, 300);
            }
        });

        closeDetailModal.addEventListener("click", closeModal);
        closeOrderModal.addEventListener("click", closeModal);
        closeAdminModal.addEventListener("click", closeModal);
        closeImageZoomModal.addEventListener("click", closeModal);

        detailModal.addEventListener("click", function (e) {
            if (e.target === detailModal) {
                closeModal();
            }
        });

        orderModal.addEventListener("click", function (e) {
            if (e.target === orderModal) {
                closeModal();
            }
        });

        adminLoginModal.addEventListener("click", function (e) {
            if (e.target === adminLoginModal) {
                closeModal();
            }
        });

        imageZoomModal.addEventListener("click", function (e) {
            if (e.target === imageZoomModal) {
                closeModal();
            }
        });

        orderForm.addEventListener("submit", function (e) {
            e.preventDefault();

            const customerName = document.getElementById("customerName").value.trim();

            if (!customerName) {
                showNotification("Silakan isi nama lengkap Anda", "warning");
                return;
            }

            if (!selectedPackage) {
                showNotification("Silakan pilih paket terlebih dahulu", "warning");
                return;
            }

            submitOrderBtn.innerHTML = '<span class="loading"></span> Mengirim pesan...';
            submitOrderBtn.disabled = true;

            let message = `Halo Admin SNAYDER'S STORE, saya ingin melakukan pemesanan:\n\n`;
            message += `Nama: ${customerName}\n`;
            message += `Produk: ${selectedProduct.name}\n`;
            message += `Paket: ${selectedPackage.name}\n`;
            message += `Harga: ${formatPrice(selectedPackage.price)}\n\n`;
            message += `Deskripsi Produk:\n${selectedProduct.description}\n\n`;
            message += `Terima kasih, saya tunggu konfirmasinya.`;

            setTimeout(() => {
                const encodedMessage = encodeURIComponent(message);
                window.open(`https://wa.me/6287866361260?text=${encodedMessage}`, "_blank");

                orderForm.reset();
                submitOrderBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Order via WhatsApp';
                submitOrderBtn.disabled = false;
                closeModal();

                showNotification("Pesanan berhasil dikirim ke WhatsApp!", "success");
            }, 1500);
        });

        document.querySelectorAll(".admin-login-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
                adminLoginModal.classList.add("active");
            });
        });

        adminLoginForm.addEventListener("submit", function (e) {
            e.preventDefault();

            const username = adminUsernameInput.value;
            const password = adminPasswordInput.value;

            fetch("/api/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ username, password }),
            })
                .then((response) => {
                    if (response.status === 401) {
                        throw new Error("Unauthorized");
                    }
                    return response.json();
                })
                .then((data) => {
                    if (data.success) {
                        localStorage.setItem("adminLoggedIn", "true");
                        showNotification("Login berhasil! Mengarahkan ke panel admin...", "success");

                        setTimeout(() => {
                            window.location.href = "admin-panel.html";
                        }, 2000);
                    } else {
                        showNotification(data.message || "Username atau password salah!", "error");
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                    if (error.message === "Unauthorized") {
                        showNotification("Username atau password salah!", "error");
                    } else {
                        showNotification("Terjadi kesalahan. Silakan coba lagi.", "error");
                    }
                });
        });

        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
            anchor.addEventListener("click", function (e) {
                e.preventDefault();

                const targetId = this.getAttribute("href");
                if (targetId === "#") return;

                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: "smooth",
                    });
                }
            });
        });

        menuToggle.addEventListener("click", () => {
            navLinks.classList.toggle("active");
            menuToggle.classList.toggle("active");
        });

        document.addEventListener("click", function (e) {
            if (!navLinks.contains(e.target) && !menuToggle.contains(e.target)) {
                navLinks.classList.remove("active");
                menuToggle.classList.remove("active");
            }
        });

        searchInput.addEventListener("input", function () {
            const searchTerm = this.value.toLowerCase().trim();

            if (searchTerm.length < 2) {
                renderProducts(products);
                return;
            }

            const filteredProducts = products.filter((product) => product.name.toLowerCase().includes(searchTerm) || product.description.toLowerCase().includes(searchTerm));

            renderProducts(filteredProducts);
        });
        // Tambahkan logika search input mobile
        const searchInputMobile = document.getElementById("searchInputMobile");
        searchInputMobile?.addEventListener("input", function () {
            const searchTerm = this.value.toLowerCase().trim();

            if (searchTerm.length < 2) {
                renderProducts(products);
                return;
            }

            const filteredProducts = products.filter((product) => (product.name + " " + product.description).toLowerCase().includes(searchTerm));

            renderProducts(filteredProducts);
        });
        document.querySelectorAll(".theme-toggle-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
                const isLight = document.documentElement.getAttribute("data-theme") === "light";
                if (isLight) {
                    document.documentElement.removeAttribute("data-theme");
                    localStorage.setItem("theme", "dark");
                    document.querySelectorAll(".theme-toggle-btn i").forEach((icon) => {
                        icon.classList.remove("fa-sun");
                        icon.classList.add("fa-moon");
                    });
                } else {
                    document.documentElement.setAttribute("data-theme", "light");
                    localStorage.setItem("theme", "light");
                    document.querySelectorAll(".theme-toggle-btn i").forEach((icon) => {
                        icon.classList.remove("fa-moon");
                        icon.classList.add("fa-sun");
                    });
                }
            });
        });

        function filterProductsByCategory(keyword) {
            if (keyword === "all") {
                renderProducts(products); // tampilkan semua produk
                return;
            }

            const filtered = products.filter((product) => (product.name + " " + product.description).toLowerCase().includes(keyword.toLowerCase()));

            renderProducts(filtered);

            if (filtered.length === 0) {
                showNotification(`Tidak ada produk dengan kata "${keyword}"`, "warning");
            }
        }

        function scrollToProduct(target) {
            if (target === "trending") {
                document.getElementById("trending").scrollIntoView({ behavior: "smooth" });
                return;
            }

            if (target === "all") {
                renderProducts(products); // <== tambahkan ini agar reset produk
                document.getElementById("produk").scrollIntoView({ behavior: "smooth" });
                return;
            }

            filterProductsByCategory(target);
            document.getElementById("produk").scrollIntoView({ behavior: "smooth" });
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const savedTheme = localStorage.getItem("theme");
            if (savedTheme === "light") {
                document.documentElement.setAttribute("data-theme", "light");
                document.querySelectorAll(".theme-toggle-btn i").forEach((icon) => {
                    icon.classList.remove("fa-moon");
                    icon.classList.add("fa-sun");
                });
            }

            loadingOverlay.classList.add("show");

            try {
                products = await fetchProducts();
                renderProducts(products);
                renderTrendingProducts(products);

                setTimeout(() => {
                    loadingOverlay.classList.remove("show");
                }, 600);
            } catch (error) {
                console.error("Failed to load data:", error);
                showNotification("Gagal memuat data, coba lagi nanti", "error");
                loadingOverlay.classList.remove("show");
            }

            document.querySelectorAll(".product-nav-btn").forEach((btn) => {
                btn.addEventListener("click", function () {
                    document.querySelectorAll(".product-nav-btn").forEach((b) => b.classList.remove("active"));
                    this.classList.add("active");
                    const target = this.getAttribute("data-target");
                    scrollToProduct(target);
                });
            });

            grecaptcha.ready(function () {
                grecaptcha.execute("6LfZknsrAAAAAOfe66QaWr0TzRixA1oGm-IMo8sc", { action: "submit" }).then(function (token) {
                    fetch("/api/verify-recaptcha", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ token }),
                    })
                        .then((res) => res.json())
                        .then((data) => {
                            if (data.success && data.score > 0.5) {
                                console.log("Human verified:", data);
                            } else {
                                console.log("reCAPTCHA failed or suspicious:", data);
                            }
                        });
                });
            });
        });
    </script>
</body>
</html>
